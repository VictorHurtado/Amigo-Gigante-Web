# HU-019 — Perfil de fundación (edición con Formik)

**Como** usuario de una fundación  
**Quiero** editar el perfil de mi fundación con un formulario completo y validado  
**Para** mantener actualizada la información pública de mi organización

---

## Dependencias

- HU-005 (MUI configurado)
- HU-007 (Tailwind configurado)
- HU-008 (Design System centralizado)
- HU-010 (Atomic Design - componentes reutilizables)
- HU-014 (Formik y Yup configurados)
- HU-016 (Sistema de traducciones configurado)
- HU-018 (Layout del dashboard con sidebar) - **REQUERIDO**

---

## Contexto / Notas

- Esta HU implementa la **página de edición del perfil de fundación**.
- El formulario usa **Formik y Yup** para validación robusta.
- Los campos se mapean a las tablas de BD:
  - `foundations`: name, description, logo_url, city, country
  - `foundation_contacts`: public_email, public_phone, instagram_url, whatsapp_url, address
- Esta HU es **solo UI y validación**: no incluye integración con Supabase (eso va en otra HU).
- El layout del dashboard (HU-018) debe estar implementado antes de esta HU.
- **IMPORTANTE**: Al crear la rama para el PR, usar el nombre: `HU-019 - Perfil de fundación`

---

## Diseño

Referencias:
- Diseño: `docs/design/code_profile_foundation_screen.html`
- Imagen: `docs/design/profile_foundation_screen.png`
- Design System: `docs/design/system.md`
- Esquema BD: `docs/scripts/db.sql`

Estructura del formulario:
- **Sección Logo**:
  - Imagen del logo actual
  - Botón "Upload New"
  - Botón "Remove"
  - Texto de ayuda (tamaño recomendado, formatos)
- **Campos del formulario** (grid de 2 columnas en desktop):
  - Foundation Name (full width)
  - Description (full width, textarea con contador de caracteres)
  - **Divider: Location**
  - Street Address (full width, con icono)
  - City
  - Country (select)
  - **Divider: Public Contact**
  - Public Email (con icono)
  - Public Phone (con icono)
  - **Divider: Social Media**
  - Instagram URL (con icono)
  - WhatsApp URL (con icono)
- **Barra de acciones**:
  - Botón "Cancel"
  - Botón "Save Changes" (con icono)

Reglas:
- Usar tokens del Design System.
- Los campos deben tener validación con Yup.
- El formulario debe mostrar errores de validación.
- El contador de caracteres para description debe actualizarse en tiempo real.
- Los botones de upload/remove del logo son solo UI (sin funcionalidad real).

---

## Alcance

Incluye:
- Crear página `/dashboard/profile` (o similar)
- Implementar formulario completo con todos los campos
- Implementar validación con Formik y Yup
- Implementar sección de logo (solo UI, sin upload real)
- Implementar estados de error y validación
- Implementar contador de caracteres para description
- Hacer el formulario responsive
- Agregar traducciones para todos los textos
- Usar el layout del dashboard (HU-018)

No incluye:
- Integración con Supabase para guardar datos
- Upload real de imágenes (solo UI del botón)
- Lógica de negocio para actualizar fundación
- Navegación funcional (los links pueden ser placeholders)
- Autenticación real (solo UI)

---

## Criterios de aceptación (Given / When / Then)

### 1) Página de perfil creada

- **Dado** que necesito editar el perfil de mi fundación
- **Cuando** navego a la ruta del perfil
- **Entonces** veo la página de edición completa
- **Y** la página usa el layout del dashboard (HU-018)
- **Y** la página se carga sin errores

---

### 2) Formulario completo implementado

- **Dado** que estoy en la página de perfil
- **Cuando** observo el formulario
- **Entonces** veo todos los campos:
  - Sección de logo con botones de upload/remove
  - Foundation Name
  - Description (textarea con contador)
  - Street Address (con icono)
  - City
  - Country (select)
  - Public Email (con icono)
  - Public Phone (con icono)
  - Instagram URL (con icono)
  - WhatsApp URL (con icono)
- **Y** los campos tienen labels correctos
- **Y** los campos tienen placeholders apropiados

---

### 3) Validación con Formik y Yup

- **Dado** que estoy en el formulario
- **Cuando** intento enviar sin completar campos requeridos
- **Entonces** se muestran mensajes de error
- **Y** los campos inválidos se marcan visualmente
- **Y** cuando completo los campos correctamente
- **Entonces** el formulario es válido y puede enviarse

---

### 4) Validaciones específicas

- **Dado** que estoy en el formulario
- **Cuando** ingreso datos inválidos:
  - Email inválido
  - URL inválida (Instagram/WhatsApp)
  - Description con más de 500 caracteres
- **Entonces** se muestran mensajes de error específicos
- **Y** el formulario no se puede enviar

---

### 5) Contador de caracteres

- **Dado** que estoy en el campo Description
- **Cuando** escribo texto
- **Entonces** el contador se actualiza en tiempo real
- **Y** muestra "X/500 characters"
- **Y** cuando supero 500 caracteres, se muestra error

---

### 6) Sección de logo implementada

- **Dado** que estoy en la página de perfil
- **Cuando** observo la sección de logo
- **Entonces** veo:
  - Imagen del logo actual (o placeholder)
  - Botón "Upload New"
  - Botón "Remove"
  - Texto de ayuda sobre tamaño y formatos
- **Y** los botones tienen estados hover
- **Nota**: Los botones son solo UI, no tienen funcionalidad real

---

### 7) Layout responsive

- **Dado** que estoy en la página de perfil
- **Cuando** cambio el tamaño de la ventana
- **Entonces** el formulario se adapta:
  - Grid de 2 columnas en desktop
  - 1 columna en móvil/tablet
- **Y** todos los elementos son legibles y accesibles

---

### 8) Traducciones implementadas

- **Dado** que se implementa la página de perfil
- **Cuando** se revisa el código
- **Entonces** todos los textos usan `useTranslations` de `next-intl`
- **Y** existen traducciones en `src/messages/es/profile.json` y `src/messages/en/profile.json`
- **Y** los mensajes de validación también están traducidos
- **Y** no hay textos hardcodeados

---

### 9) Estados visuales

- **Dado** que estoy en el formulario
- **Cuando** hago focus en un campo
- **Entonces** el campo muestra estado de focus (borde, ring)
- **Y** cuando hay error, el campo muestra estado de error
- **Y** los botones tienen estados hover y active

---

### 10) Uso del Design System

- **Dado** que se implementa el formulario
- **Cuando** se revisa el código
- **Entonces** se usan tokens del Design System:
  - `brand-500` o `primary.main` para botones primarios
  - `neutral-*` para textos y bordes
  - Tokens de spacing y tipografía
- **Y** no hay colores hardcodeados fuera de los tokens

---

## Reglas técnicas

### Arquitectura
- Presentation solo consume UseCases vía IoC (no importa repositorios concretos).
- Domain no importa React/Next/MUI/Tailwind/Inversify.
- Infrastructure contiene implementaciones y wiring IoC.
- **Esta HU es solo Presentation**: no toca Domain ni Infrastructure.
- **NO incluye integración con Supabase** (solo UI y validación).

### UI
- Usar MUI para componentes base (TextField, Button, Select, etc.).
- Tailwind se usa para layout/spacing/responsive utilities.
- Usar tokens del Design System (`brand-500`, `accent-500`, `neutral-*`).
- Los componentes deben ser reutilizables cuando sea posible.

### Formik y Yup
- Usar `useFormik` hook de Formik.
- Crear schema de validación con Yup.
- Validar campos requeridos: name, description, city, country, public_email.
- Validar formatos: email, URLs (Instagram/WhatsApp).
- Validar longitud: description máximo 500 caracteres.
- Mostrar errores de validación debajo de cada campo.

### Responsive
- Grid de 2 columnas en desktop (md+).
- 1 columna en móvil/tablet.
- Campos full-width cuando corresponde (name, description, address).
- Botones responsive (full-width en móvil, auto en desktop).

### Traducciones (OBLIGATORIO)
- **TODOS los textos visibles en la UI deben estar traducidos** (español e inglés).
- Usar el sistema de traducciones configurado en HU-016 (`next-intl`).
- Agregar traducciones en:
  - `src/messages/es/profile.json` (español)
  - `src/messages/en/profile.json` (inglés)
- Incluir traducciones para:
  - Labels de campos
  - Placeholders
  - Mensajes de validación
  - Botones
  - Textos de ayuda
- **NO hardcodear textos en español o inglés** en componentes.
- Usar `useTranslations('profile')` hook de `next-intl`.

### Layout
- **Usar el layout del dashboard creado en HU-018**.
- La página debe estar en `app/dashboard/profile/page.tsx` (o ruta similar).
- El layout ya proporciona sidebar y header.

### Dependencias / Paquetes
- No agregar dependencias nuevas salvo que esta HU lo indique explícitamente.
- Formik y Yup ya están instalados (HU-014).
- Si aparece error 403/conectividad:
  1) Detenerse
  2) Pedir dominios requeridos
  3) Explicar por qué se requieren
  4) No continuar

### Git / Branching
- **Al crear la rama para el PR, usar el nombre**: `HU-019 - Perfil de fundación`

---

## Implementación sugerida

### Estructura de archivos sugerida:
```
src/app/dashboard/profile/
└── page.tsx                     # Página de perfil

src/presentation/components/profile/
├── ProfileForm.tsx              # Formulario principal con Formik
├── LogoSection.tsx              # Sección de logo (upload/remove)
└── ProfileValidation.ts         # Schema de validación con Yup

src/messages/
├── es/
│   └── profile.json             # Traducciones en español
└── en/
    └── profile.json             # Traducciones en inglés
```

### Componentes principales:

1. **ProfilePage** (`src/app/dashboard/profile/page.tsx`):
   - Usa el layout del dashboard (HU-018)
   - Renderiza ProfileForm
   - Puede pasar datos iniciales (mock data para UI)

2. **ProfileForm**:
   - Usa `useFormik` para manejo de formulario
   - Usa schema de validación de Yup
   - Renderiza todos los campos
   - Maneja estados de error y validación
   - Muestra mensajes de error

3. **LogoSection**:
   - Muestra imagen del logo (o placeholder)
   - Botones de upload/remove (solo UI)
   - Texto de ayuda

4. **ProfileValidation** (`ProfileValidation.ts`):
   - Schema de Yup con todas las validaciones
   - Mensajes de error traducidos (usar función que obtiene traducciones)

### Schema de validación sugerido:

```typescript
import * as Yup from 'yup';
import { useTranslations } from 'next-intl';

export const getProfileValidationSchema = () => {
  const t = useTranslations('profile.validation');
  
  return Yup.object({
    name: Yup.string()
      .required(t('name.required'))
      .min(3, t('name.minLength')),
    description: Yup.string()
      .required(t('description.required'))
      .max(500, t('description.maxLength')),
    address: Yup.string()
      .required(t('address.required')),
    city: Yup.string()
      .required(t('city.required')),
    country: Yup.string()
      .required(t('country.required')),
    publicEmail: Yup.string()
      .required(t('publicEmail.required'))
      .email(t('publicEmail.invalid')),
    publicPhone: Yup.string()
      .optional(),
    instagramUrl: Yup.string()
      .url(t('instagramUrl.invalid'))
      .optional(),
    whatsappUrl: Yup.string()
      .url(t('whatsappUrl.invalid'))
      .optional(),
  });
};
```

### Estructura de traducciones sugerida:

**src/messages/es/profile.json:**
```json
{
  "title": "Editar Perfil de Fundación",
  "subtitle": "Actualiza los detalles de tu organización para que los adoptantes puedan contactarte fácilmente.",
  "logo": {
    "title": "Logo de la Fundación",
    "help": "Tamaño recomendado 400x400px. Formatos soportados: JPG, PNG.",
    "upload": "Subir Nuevo",
    "remove": "Eliminar"
  },
  "fields": {
    "name": {
      "label": "Nombre de la Fundación",
      "placeholder": "Ingresa el nombre de tu fundación"
    },
    "description": {
      "label": "Descripción",
      "placeholder": "Describe tu fundación...",
      "charCount": "{current}/500 caracteres"
    },
    "address": {
      "label": "Dirección",
      "placeholder": "Ingresa la dirección"
    },
    "city": {
      "label": "Ciudad",
      "placeholder": "Ingresa la ciudad"
    },
    "country": {
      "label": "País",
      "placeholder": "Selecciona el país"
    },
    "publicEmail": {
      "label": "Email Público",
      "placeholder": "contacto@fundacion.org"
    },
    "publicPhone": {
      "label": "Teléfono Público",
      "placeholder": "+34 93 123 4567"
    },
    "instagramUrl": {
      "label": "URL de Instagram",
      "placeholder": "https://instagram.com/..."
    },
    "whatsappUrl": {
      "label": "URL de WhatsApp",
      "placeholder": "https://wa.me/..."
    }
  },
  "sections": {
    "location": "Ubicación",
    "contact": "Contacto Público",
    "social": "Redes Sociales"
  },
  "buttons": {
    "cancel": "Cancelar",
    "save": "Guardar Cambios"
  },
  "validation": {
    "name": {
      "required": "El nombre de la fundación es requerido",
      "minLength": "El nombre debe tener al menos 3 caracteres"
    },
    "description": {
      "required": "La descripción es requerida",
      "maxLength": "La descripción no puede exceder 500 caracteres"
    },
    "address": {
      "required": "La dirección es requerida"
    },
    "city": {
      "required": "La ciudad es requerida"
    },
    "country": {
      "required": "El país es requerido"
    },
    "publicEmail": {
      "required": "El email público es requerido",
      "invalid": "Ingresa un email válido"
    },
    "instagramUrl": {
      "invalid": "Ingresa una URL válida de Instagram"
    },
    "whatsappUrl": {
      "invalid": "Ingresa una URL válida de WhatsApp"
    }
  }
}
```

**src/messages/en/profile.json:**
```json
{
  "title": "Edit Foundation Profile",
  "subtitle": "Update your organization's details so adopters can reach you easily.",
  "logo": {
    "title": "Foundation Logo",
    "help": "Recommended size 400x400px. Supported formats: JPG, PNG.",
    "upload": "Upload New",
    "remove": "Remove"
  },
  "fields": {
    "name": {
      "label": "Foundation Name",
      "placeholder": "Enter your foundation's name"
    },
    "description": {
      "label": "Description",
      "placeholder": "Describe your foundation...",
      "charCount": "{current}/500 characters"
    },
    "address": {
      "label": "Street Address",
      "placeholder": "Enter the address"
    },
    "city": {
      "label": "City",
      "placeholder": "Enter the city"
    },
    "country": {
      "label": "Country",
      "placeholder": "Select the country"
    },
    "publicEmail": {
      "label": "Public Email",
      "placeholder": "contact@foundation.org"
    },
    "publicPhone": {
      "label": "Public Phone",
      "placeholder": "+34 93 123 4567"
    },
    "instagramUrl": {
      "label": "Instagram URL",
      "placeholder": "https://instagram.com/..."
    },
    "whatsappUrl": {
      "label": "WhatsApp URL",
      "placeholder": "https://wa.me/..."
    }
  },
  "sections": {
    "location": "Location",
    "contact": "Public Contact",
    "social": "Social Media"
  },
  "buttons": {
    "cancel": "Cancel",
    "save": "Save Changes"
  },
  "validation": {
    "name": {
      "required": "Foundation name is required",
      "minLength": "Name must be at least 3 characters"
    },
    "description": {
      "required": "Description is required",
      "maxLength": "Description cannot exceed 500 characters"
    },
    "address": {
      "required": "Address is required"
    },
    "city": {
      "required": "City is required"
    },
    "country": {
      "required": "Country is required"
    },
    "publicEmail": {
      "required": "Public email is required",
      "invalid": "Please enter a valid email"
    },
    "instagramUrl": {
      "invalid": "Please enter a valid Instagram URL"
    },
    "whatsappUrl": {
      "invalid": "Please enter a valid WhatsApp URL"
    }
  }
}
```

### Notas de implementación:
- Usar `TextField` de MUI con `error` y `helperText` para mostrar errores.
- El contador de caracteres puede calcularse desde `formik.values.description.length`.
- Los dividers pueden ser `Divider` de MUI o `Typography` con estilo.
- El select de país puede usar `Select` de MUI o un componente personalizado.
- Los iconos pueden ser de `@mui/icons-material`.
- Los botones de upload/remove pueden ser `Button` de MUI (solo UI, sin funcionalidad).

---

## Validación

Comandos mínimos:
- `npm run dev` (verificar que la página se carga correctamente)
- `npm run build` (verificar que no hay errores de compilación)

Verificaciones visuales:
- El formulario se ve igual al diseño de referencia
- La validación funciona correctamente
- Los mensajes de error se muestran apropiadamente
- El contador de caracteres funciona
- El formulario es responsive
- Las traducciones funcionan correctamente
- No hay textos hardcodeados

---

## Definición de Hecho

- [ ] Criterios de aceptación cumplidos
- [ ] `npm run dev` OK
- [ ] `npm run build` OK
- [ ] Página de perfil creada y accesible
- [ ] Formulario completo con todos los campos
- [ ] Validación con Formik y Yup implementada
- [ ] Sección de logo implementada (solo UI)
- [ ] Contador de caracteres funcionando
- [ ] Estados visuales de error y validación
- [ ] Layout responsive
- [ ] **Traducciones incluidas**:
  - [ ] Textos agregados en `src/messages/es/profile.json`
  - [ ] Textos agregados en `src/messages/en/profile.json`
  - [ ] Componentes usan `useTranslations` (no textos hardcodeados)
  - [ ] Mensajes de validación traducidos
  - [ ] Keys consistentes entre idiomas
- [ ] Uso correcto de tokens del Design System
- [ ] Layout del dashboard (HU-018) usado correctamente
- [ ] Sin violaciones de capas
- [ ] Sin cambios fuera del alcance
- [ ] Rama creada con nombre: `HU-019 - Perfil de fundación`
- Commit sugerido:
  `feat: add foundation profile edit form with Formik validation`

