# HU-016 — Sistema de traducciones (i18n) español/inglés

**Como** usuario  
**Quiero** ver la aplicación en español o inglés según mi preferencia  
**Para** usar la plataforma en mi idioma preferido

---

## Dependencias

- HU-001 (Next.js App Router funcionando)

---

## Contexto / Notas

- Esta HU implementa un sistema de internacionalización (i18n) completo.
- Se soportan dos idiomas: Español (es) e Inglés (en).
- Se usa `next-intl` que es la solución recomendada para Next.js App Router.
- El idioma se detecta automáticamente desde el navegador o se puede cambiar manualmente.
- Las traducciones se almacenan en archivos JSON organizados por namespace.
- Se debe seguir buenas prácticas: type-safety, namespaces, lazy loading.

---

## Alcance

Incluye:
- Instalación y configuración de `next-intl`
- Estructura de carpetas para traducciones (es, en)
- Configuración de middleware para detectar/cambiar idioma
- Creación de archivos de traducción organizados por namespace
- Hook/provider para usar traducciones en componentes
- Selector de idioma en la UI
- Traducción de textos existentes en componentes clave
- Configuración de routing por locale (opcional, si se requiere)

No incluye:
- Traducción completa de toda la aplicación (solo estructura y ejemplos)
- Traducción de contenido dinámico de BD (solo UI)
- RTL (Right-to-Left) para otros idiomas
- Más de 2 idiomas (solo es y en)

---

## Criterios de aceptación (Given / When / Then)

### 1) next-intl instalado y configurado

- **Dado** que se necesita i18n
- **Cuando** se instala la librería
- **Entonces** existe `next-intl` en `package.json`
- **Y** está configurado correctamente para Next.js App Router

---

### 2) Estructura de traducciones creada

- **Dado** que se necesitan archivos de traducción
- **Cuando** se crea la estructura
- **Entonces** existen carpetas:
  - `src/messages/es/` (traducciones en español)
  - `src/messages/en/` (traducciones en inglés)
- **Y** cada carpeta contiene archivos JSON organizados por namespace (ej: `common.json`, `home.json`, `register.json`)

---

### 3) Configuración de next-intl

- **Dado** que se configura next-intl
- **Cuando** se revisa la configuración
- **Entonces** existe:
  - `src/i18n/request.ts` (configuración del request)
  - `src/i18n/config.ts` (configuración de locales)
  - Middleware configurado para detectar idioma
- **Y** los locales soportados son `es` y `en`

---

### 4) Hook de traducciones funcional

- **Dado** que se necesita usar traducciones en componentes
- **Cuando** se implementa el hook
- **Entonces** existe un hook `useTranslations` (de next-intl)
- **Y** se puede usar en componentes de React
- **Y** es type-safe (TypeScript)

---

### 5) Archivos de traducción con contenido

- **Dado** que se crean archivos de traducción
- **Cuando** se revisan los archivos
- **Entonces** existen traducciones para:
  - Textos comunes (`common.json`)
  - Home page (`home.json`)
  - Registro (`register.json`)
- **Y** cada archivo tiene las mismas keys en ambos idiomas
- **Y** las traducciones están completas y correctas

---

### 6) Selector de idioma en UI

- **Dado** que el usuario quiere cambiar el idioma
- **Cuando** se implementa el selector
- **Entonces** existe un componente selector de idioma
- **Y** permite cambiar entre español e inglés
- **Y** el cambio se persiste (localStorage o cookie)
- **Y** la página se actualiza con el nuevo idioma

---

### 7) Componentes traducidos

- **Dado** que existen componentes con texto hardcodeado
- **Cuando** se implementan traducciones
- **Entonces** al menos estos componentes usan traducciones:
  - HomeNavBar
  - HeroSection
  - RegisterForm
  - Copyright
- **Y** los textos se muestran en el idioma seleccionado

---

### 8) Detección automática de idioma

- **Dado** que el usuario visita la aplicación por primera vez
- **Cuando** se carga la página
- **Entonces** el idioma se detecta automáticamente desde:
  - Preferencia del navegador
  - O configuración guardada (localStorage/cookie)
- **Y** si no hay preferencia, usa español como default

---

## Reglas técnicas

### Arquitectura
- Presentation solo consume UseCases vía IoC (no importa repositorios concretos).
- Domain no importa React/Next/MUI/Tailwind/Inversify/next-intl.
- Infrastructure contiene implementaciones y wiring IoC.
- **next-intl solo en Presentation**: componentes y configuración.

### i18n
- Usar `next-intl` como librería principal.
- Organizar traducciones por namespace (common, home, register, etc.).
- Usar keys descriptivas y anidadas: `home.hero.title`, `register.form.email.label`.
- Mantener consistencia en las keys entre idiomas.

### Estructura de traducciones
```
src/messages/
├── es/
│   ├── common.json
│   ├── home.json
│   └── register.json
└── en/
    ├── common.json
    ├── home.json
    └── register.json
```

### Type Safety
- Usar TypeScript para type-safety en traducciones.
- Definir tipos/interfaces para los namespaces si es posible.
- Validar que todas las keys existan en ambos idiomas.

### Dependencias / Paquetes
- Instalar `next-intl` como dependencia.
- Si aparece error 403/conectividad:
  1) Detenerse
  2) Pedir dominios requeridos
  3) Explicar por qué se requieren
  4) No continuar

---

## Implementación sugerida

### Fase 1: Instalación
1. Instalar `next-intl`:
   ```bash
   npm install next-intl
   ```

### Fase 2: Configuración
1. Crear `src/i18n/config.ts`:
   - Definir locales: `['es', 'en']`
   - Default locale: `'es'`

2. Crear `src/i18n/request.ts`:
   - Configurar `getRequestConfig` de next-intl
   - Cargar traducciones según locale

3. Crear `middleware.ts` (raíz):
   - Detectar locale desde header o cookie
   - Redirigir a ruta con locale si es necesario

### Fase 3: Estructura de traducciones
1. Crear carpetas `src/messages/es/` y `src/messages/en/`
2. Crear archivos JSON por namespace:
   - `common.json`: textos comunes (botones, labels, etc.)
   - `home.json`: textos de la página home
   - `register.json`: textos del formulario de registro

### Fase 4: Integración en componentes
1. Envolver la app con `NextIntlClientProvider` (si es necesario)
2. Usar `useTranslations` hook en componentes
3. Reemplazar textos hardcodeados por llamadas a traducciones

### Fase 5: Selector de idioma
1. Crear componente `LanguageSelector`
2. Permitir cambiar entre es/en
3. Guardar preferencia en localStorage o cookie
4. Actualizar la página con el nuevo idioma

### Ejemplo de estructura de traducciones:

**src/messages/es/common.json:**
```json
{
  "buttons": {
    "search": "Buscar",
    "login": "Iniciar Sesión",
    "register": "Registrarse"
  },
  "navigation": {
    "adopt": "Adopta",
    "sponsor": "Apadrina",
    "foundations": "Fundaciones",
    "store": "Tienda Solidaria"
  }
}
```

**src/messages/en/common.json:**
```json
{
  "buttons": {
    "search": "Search",
    "login": "Log In",
    "register": "Sign Up"
  },
  "navigation": {
    "adopt": "Adopt",
    "sponsor": "Sponsor",
    "foundations": "Foundations",
    "store": "Charity Store"
  }
}
```

### Ejemplo de uso en componente:

```tsx
import { useTranslations } from 'next-intl';

export function HomeNavBar() {
  const t = useTranslations('common');
  
  return (
    <Button>{t('buttons.login')}</Button>
  );
}
```

---

## Validación

Comandos mínimos:
- `npm run dev` (verificar que las traducciones funcionan)
- `npm run build` (verificar que no hay errores de compilación)

Verificaciones:
- El selector de idioma funciona correctamente
- Los textos cambian al cambiar el idioma
- La detección automática de idioma funciona
- Los componentes muestran textos traducidos
- No hay textos hardcodeados en los componentes traducidos

---

## Definición de Hecho

- [ ] Criterios de aceptación cumplidos
- [ ] `npm run dev` OK
- [ ] `npm run build` OK
- [ ] next-intl instalado y configurado
- [ ] Estructura de traducciones creada (es, en)
- [ ] Configuración de next-intl implementada
- [ ] Hook de traducciones funcional
- [ ] Archivos de traducción con contenido
- [ ] Selector de idioma implementado
- [ ] Componentes clave traducidos
- [ ] Detección automática de idioma funciona
- [ ] Sin violaciones de capas
- [ ] Sin cambios fuera del alcance
- Commit sugerido:
  `feat: implement i18n system with spanish and english support`

